#!/usr/bin/env bash

set -euo pipefail

# List all available PostgreSQL versions from theseus-rs/postgresql-binaries
# Output must be a single space-separated line, newest last

RELEASES_HTML="https://github.com/theseus-rs/postgresql-binaries/releases"
TAGS_HTML="https://github.com/theseus-rs/postgresql-binaries/tags"

fetch_html_versions() {
  local url=$1
  curl -sS "$url" \
    | grep -Eo 'releases/tag/[0-9]+(\.[0-9]+){2}' \
    | sed -E 's#.*/tag/##' \
    | sort -u
}

versions=$(fetch_html_versions "$RELEASES_HTML" || true)
if [ -z "${versions}" ]; then
  versions=$(fetch_html_versions "$TAGS_HTML" || true)
fi

printf "%s\n" "$versions" | sort -t '.' -k1,1n -k2,2n -k3,3n | tr '\n' ' ' 
